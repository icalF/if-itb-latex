%!TeX root=../thesis.tex

\chapter{Implementasi dan Pengujian}

Pembahasan pada bab ini akan dibagi menjadi dua bagian. Bagian pertama dipaparkan tentang lingkungan dan detail implementasi. Sedangkan bagian kedua dibahas mengenai teknis dan hasil pengujian terhadap perangkat lunak yang sudah dibangun.

\section{Implementasi}

  Bagian implementasi dibagi menjadi 4 bagian. Bagian pertama dibahas mengenai lingkungan implementasi. Bagian kedua dibahas mengenai batasan implementasi. Bagian ketiga dibahas mengenai spesifikasi modul. Bagian terakhir berisi konfigurasi sistem deteksi intrusi.

  \subsection{Lingkungan Implementasi}

    Dalam proses implementasi digunakan sebuah komputer dan sejumlah perangkat lunak untuk menyelesaikan perangkat lunak yang dibangun. Detil spesifikasi perangkat keras dan lunak yang digunakan adalah seperti pada Tabel IV.1.
    
    \input{tables/dev-specs.tex}

  \subsection{Batasan Implementasi}

    Implementasi dilakukan dengan batasan-batasan sebagai berikut.

    \begin{enumerate}

      \item Implementasi hanya mengerjakan komponen MPSE (\emph{multipattern search engine}) pada Snort

      \item Pencocokan menggunakan satu \emph{instance} GPU
    
      \item Pencocokan hanya dilakukan pada satu \emph{thread kernel code}
    
      \item Akuisisi \emph{payload} hanya dilakukan dari berkas PCAP

    \end{enumerate}

  \subsection{Spesifikasi Komponen}

    Implementasi dilakukan dengan membuat beberapa komponen, yaitu:

    \begin{enumerate}

      \item
      \emph{Handle} \\
      \emph{Handle} merupakan struktur data yang membungkus fungsionalitas pencocokan untuk dapat digunakan pada \emph{pipeline} Snort. \emph{Handle} berisi fungsi-fungsi yang terkait modul yang dikembangkan seperti menambahkan pola, pembentukan kamus, pencarian, dan mencetak informasi spesifik \emph{handle}. Fungsi-fungsi pada \emph{handle} akan memanggil modul lain yang terkait, misalnya fungsi pembentukan kamus akan memanggil komponen pembentukan kamus pada kode PFAC yang dibuat.

      \item
      \emph{State machine} \\
      \emph{State machine} merupakan kamus yang digunakan dalam pencocokan. \emph{State machine} dibentuk di memori \emph{host}. Pola yang telah dikumpulkan dalam \emph{list}, akan disusun ulang sehingga terurut secara alfabetis. Kemudian akan dilakukan penelusuran DFS (\emph{depth-first search}) untuk membangun transisi tiap \emph{state}.

      \item
      \emph{Kernel wrapper} \\
      \emph{Kernel wrapper} adalah \emph{wrapper} yang menyiapkan \emph{payload} sebelum \emph{kernel} dijalankan. \emph{Wrapper} akan menyalin \emph{payload} dari \emph{host buffer} ke \emph{device buffer}. Setelah persiapan selesai, \emph{wrapper} akan memanggil kode \emph{kernel} untuk menjalankan pencocokan.
      
      \item
      \emph{Matcher kernel} \\
      \emph{Kernel} adalah kode GPU yang akan dijalankan untuk pencocokan. \emph{Kernel} hanya akan melakukan \emph{looping} terhadap nomor \emph{state} berdasarkan tabel transisi yang telah dimuat. \emph{Looping} akan berhenti ketika \emph{state} telah menuju \emph{state} akhir maupun status \emph{dummy}.

      \item
      \emph{Reducer} \\
      \emph{Reducer} akan menggabungkan hasil pencocokan dari tiap \emph{thread} sehingga diperoleh jumlah total rule yang terdeteksi. \emph{Reducer} dipanggil setelah \emph{matcher} dijalankan. \emph{Reducing} akan dilakukan secara sekuensial pada CPU. Hasil \emph{reducing} akan dikembalikan ke fungsi \emph{search} milik \emph{handle} untuk dikembalikan lagi ke Snort.
      
    \end{enumerate}

  % \subsection{Konfigurasi}

  %   Agar Snort dapat dijalankan dengan modul yang telah diintegrasikan, perlu dibuat pengubahan pada konfigurasi. Konfigurasi akan disuplai dari skrip lua. Diantara poin yang perlu diubah pada berkas konfigurasi yaitu:

  %   \begin{enumerate}
  %     \item Pencocokan dilakukan dengan modul PFAC yang telah selesai diintegrasikan.
  %     \item Modul \emph{daq (data acquisition)} yang digunakan hanya pcap-daq untuk dapat membaca berkas PCAP.
  %     \item \emph{Ruleset} diatur menunjuk ke lokasi \emph{rule} Talos.
  %     \item \emph{Buffer} untuk \emph{payload} diatur sebesar 128 kB.
  %   \end{enumerate}

\section{Pengujian}

  \subsection{Tujuan Pengujian}
    Pengujian dilakukan untuk mendapatkan perbandingan kinerja antara modul yang dikembangkan dan modul yang ada dalam NIDS Snort. 

  \subsection{Skenario Pengujian}
  
    Pengujian dilakukan untuk mengukur peningkatan kinerja deteksi Snort. Skenario yang akan diujikan meliputi strategi-strategi yang dibahas pada Subbab III.2. Berikut ini adalah tipe-tipe skenario yang diuji dalam pengujian ini.

    \begin{enumerate}
      
      \item \emph{Baseline} (Aho-Corasick dengan \emph{multithreading} CPU) \\
      \emph{Baseline} akan menggunakan konfigurasi default Snort. Ini menjadi dasar pengukuran kinerja dan kebenaran program yang diimplementasikan pada GPU.

      \item Skenario 1 (PFAC dengan \emph{global memory}) \\
      Skenario ini adalah skenario paling dasar. Optimasi hanya dilakukan pada algoritma tanpa melibatkan optimasi pada latensi GPU.

      \item Skenario 2 (PFAC dengan \emph{shared memory}) \\
      Skenario ini memanfaatkan \emph{shared memory} untuk mengurangi akses ke \emph{global memory}. Transisi \emph{state} awal ke tiap huruf serta \emph{stream} masukan ditampung dalam \emph{shared memory}.

      \item Skenario 3 (PFAC dengan \emph{shared memory} dan \emph{pinned memory}) \\
      Skenario ini mirip dengan skenario 2 dengan tambahan \emph{pinned memory} pada \emph{buffer}. Mekanisme ini diharapkan dapat mengurangi \emph{swappiness} dan memungkinkan DMA (\emph{direct memory access}).

      \item Skenario 4 (PFAC dengan \emph{shared memory}, \emph{pinned memory}, dan \emph{texture memory}) \\
      Skenario ini mirip dengan skenario 3 dengan tambahan \emph{texture memory} pada kamus. Dengan \emph{cache} yang lebih besar, penggunaan \emph{texture memory} diharapkan mengurangi transfer memori.

    \end{enumerate}

    Kelima skenario akan diuji dengan ukuran \emph{buffer} berbeda.

  \subsection{Hasil Pengujian}

    Berikut merupakan hasil pengujian dari seluruh skenario di atas. \emph{Ruleset} yang digunakan yaitu Snort VRT \emph{ruleset} versi 3000. Sedangkan berkas masukan didapatkan dari \emph{log traffic} kompetisi DEFCON 25 yang berlangsung pada bulan Juli tahun 2017. Dataset didapatkan dari jaringan \emph{torrent} milik arsip DEFCON berupa beberapa berkas PCAP sebesar sekitar 2,6 GB. Berikut adalah hasil pengujian pada ukuran \emph{buffer} berbeda.\clearpage

    \input{tables/test-result.tex}  

  \subsection{Analisis Hasil Pengujian}
    
    Dari hasil pengujian, didapatkan bahwa hasil skenario 1 memilki kapasitas paling rendah. Alasannya yaitu karena operasi pencocokan sering melakukan \emph{fetch} ke \emph{global memory}. 
    
    Skenario 2 secara umum lebih cepat beberapa kali daripada skenario 1. Sekitar ? hingga ? kali lipat lebih cepat. Karena latensi antara \emph{global memory} dan \emph{shared memory} terpaut jauh sehingga mengakibatkan kapasitas meningkat.

    Skenario 3 tidak terlalu berpengaruh terhadap skenario 2. Keuntungan \emph{pinned memory} tidak terlalu terlihat bahkan cenderung memperlambat. Sejalan dengan eksperimen yang dilakukan \cite{gnort2008}, \emph{pinned memory} memiliki \emph{overhead} saat alokasi dan dealokasi.

    Sedangkan skenario 4 baru terlihat perbedaan signifikan terhadap skenario 2 dan 3 pada \emph{buffer} sebesar 1 MB ke atas. Adanya \emph{cache} pada memori tekstur membantu menurunkan akses ke memori global dan meningkatkan kinerja keseluruhan modul.